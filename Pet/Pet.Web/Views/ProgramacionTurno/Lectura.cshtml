@{
    Layout = null;
}


<div class="block ng-scope" style="">

    <div class="block_menu">
        <div style="max-width: 100%; height: 100%">
            <div class="boton">
                <button class="SeparatorLeft boton1Style boton1" onclick="Salir_Click();" style="">
                    <span class="boton1Span">
                        <img class="boton1Img csBtnSalir" alt="Salir" src="/Images/formatmap32x32.png">
                    </span>
                    <span class="boton1txt">Salir</span>
                </button>
            </div>
        </div>
    </div>


    <!-- SECCION DATOS GENERALES -->
    <div id="seccion-1">
        <div class="block_cab block_cab_active">
            <h2>
                <span>Datos Generales</span>
            </h2>
            <h3></h3>
            <div class="acordeon">
            </div>
        </div>
        <form id="RegistroProgramacionFrm" name="RegistroProgramacionFrm" class="ng-pristine ng-invalid ng-invalid-required">
            <div class="block_content" style="width: 100%">
                <!------------------- 1 Seccion -------------------------------------------->
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="col-md-12 row">
                                <div class="col-md-4">
                                    Sede
                                </div>
                                <div class="col-md-8">
                                    <select class="InputSELECT_01" id="cboSede" style="background: #dddddd;" disabled>
                                        <option value="">[Seleccione]</option>
                                     

                                    </select>
                                    <div class="caja11 msgerror Sede">
                                        <span class="field-validation-valid msgerror" data-valmsg-for="Sede" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="col-md-12 row">
                                <div class="col-md-4">
                                    Año
                                </div>
                                <div class="col-md-8">
                                    <select class="InputSELECT_01" id="cboAnio" style="background: #dddddd;" disabled>
                                        <option value="">[Seleccione]</option>
                                   
                                    </select>
                                    <div class="caja11 msgerror Anio">
                                        <span class="field-validation-valid msgerror" data-valmsg-for="Anio" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="col-md-12 row">
                                <div class="col-md-4">
                                    Mes
                                </div>
                                <div class="col-md-8">
                                    <select class="InputSELECT_01" id="cboMes" style="background: #dddddd;" disabled>
                                        <option value="">[Seleccione]</option>
                                      
                                    </select>
                                    <div class="caja11 msgerror Mes">
                                        <span class="field-validation-valid msgerror" data-valmsg-for="Mes" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!------------------- 2 Seccion -------------------------------------------->
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="col-md-4">
                                Fecha Inicio
                            </div>
                            <div class="col-md-8">
                                <input class="InputTEXT_04Fecha"
                                       maxlength="10" type="text"
                                       data-bind="dateValue: FechaInicio,datePattern: 'dd/MM/yyyy'"
                                       data-val="true"
                                       data-val-date="El campo Fecha Inicio debe ser una fecha."
                                       id="FechaInicio"
                                       name="FechaInicio"
                                       required
                                       control_max_date="FechaFin" disabled />
                                <div class="caja11 msgerror FechaInicio">
                                    <span class="field-validation-valid msgerror" data-valmsg-for="FechaInicio" data-valmsg-replace="true"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="col-md-4">
                                Fecha Fin
                            </div>
                            <div class="col-md-8">
                                <input class="InputTEXT_04Fecha"
                                       maxlength="10" type="text"
                                       data-bind="dateValue: FechaFin,datePattern: 'dd/MM/yyyy'"
                                       data-val="true"
                                       ng-enter="Enter()"
                                       data-val-date="El campo Fecha Fin debe ser una fecha."
                                       id="FechaFin"
                                       name="FechaFin"
                                       required
                                       control_min_date="FechaInicio" disabled />
                                <div class="caja11 msgerror FechaFin">
                                    <span class="field-validation-valid msgerror" data-valmsg-for="FechaFin" data-valmsg-replace="true"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">

                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- SECCION DATOS GENERALES -->
    <!-- SECCION DETALLE-->
    <div id="seccion-2">

        <div style="width: 100%; float: left">
            <div class="block_cab block_cab_active">
                <h2>
                    <span>EMPLEADOS ASIGNADOS</span>
                </h2>
                <h3></h3>
                <div class="acordeon">
                </div>
            </div>
            <div class="block_menu">
                
                <div id="ContentListadoEmpleados" class="block_content">
                    <div class="form_section" style="width: 100%">
                        <table id="consultaEmpleados"></table>
                        <div id="pagerconsultaEmpleados"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- SECCION DETALLE-->


    </div>

</div>
<script type="text/javascript">
    jQuery("#consultaEmpleados").jqGrid({
        //url: 'ObtenerSolicitudes',
        datatype: "local",
        colNames: ['Turno', 'Cargo', 'Empleado', 'Responsable', 'CodigoTurno', 'CodigoCargo', 'CodigoEmpleado', 'CodigoDetalle'],
        colModel: [
            { name: 'Turno', index: 'Turno', width: 210, align: "center", sortable: false },
            { name: 'Cargo', index: 'Cargo', width: 210, align: "center", sortable: false },
            { name: 'Empleado', index: 'Empleado', width: 210, align: "center", sortable: false },
            {
                name: 'Responsable', index: 'Responsable',
                editable: true, edittype: 'checkbox', editoptions: { value: "True:False" },
                formatter: "checkbox", align: "center", formatoptions: { disabled: false }
            },
            { name: 'CodigoTurno', index: 'CodigoTurno', width: 210, align: "center", sortable: false, hidden: true },
            { name: 'CodigoCargo', index: 'CodigoCargo', width: 210, align: "center", sortable: false, hidden: true },
            { name: 'CodigoEmpleado', index: 'CodigoEmpleado', width: 210, align: "center", sortable: false, hidden: true },
            { name: 'CodigoDetalle', index: 'CodigoDetalle', width: 210, align: "center", sortable: false, hidden: true }
        ],
        rowNum: 100,
        rowList: [100, 200, 300],
        //sortname: 'Codigo',
        shrinkToFit: false,
        autowidth: true,
        gridview: true,
        viewrecords: true//,
        //sortorder: "desc"
    });
    jQuery("#consultaEmpleados").jqGrid('navGrid', '#pagerconsultaSolicitudes', { edit: false, add: false, del: false });

    $(document).ready(function () {
        CargarCombos();
        var codigoProgramacion = getParameterByName('CodigoProgramacion');
        if (codigoProgramacion > 0) {
            ObtenerProgramacionTurno(codigoProgramacion);
        }
        $('input[type="checkbox"]').prop("disabled", "true");
    });
    function CargarCombos() {
        $.ajax({
            url: "/ProgramacionTurno/ListaSede",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboSede");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
        $.ajax({
            url: "/ProgramacionTurno/ListaAnio",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboAnio");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
        $.ajax({
            url: "/ProgramacionTurno/ListaMes",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboMes");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
        $.ajax({
            url: "/ProgramacionTurno/ListaTurno",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboTurno");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
        $.ajax({
            url: "/ProgramacionTurno/ListaCargo",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboCargo");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
        $.ajax({
            url: "/ProgramacionTurno/ListaEmpleado",
            dataType: 'json',
            async: false,
            success: function (data) {
                var options = $("#cboEmpleado");
                options.empty();
                options.append('<option value="">[Seleccione]</option>');
                $.each(data, function (index, item) {
                    options.append($("<option />").val(data[index].Codigo).text(data[index].Descripcion));
                });
            }
        });
    }
    function ObtenerProgramacionTurno(codigoProgramacion) {

        var filtro = {
            codigo: codigoProgramacion
        }
        $.ajax({
            type: "POST",
            async: false,
            url: '/ProgramacionTurno/ObtenerProgramacionTurno/',
            cache: false,
            data: JSON.stringify(filtro),
            dataType: "JSON",
            contentType: "application/json",
            success: function (myData) {
                $("#cboSede").val(myData[0].CodigoSede);
                $("#cboAnio").val(myData[0].CodigoAnio);
                $("#cboMes").val(myData[0].CodigoMes);

                var arrFechaInicio = myData[0].FechaInicio.split('-');
                $("#FechaInicio").val(arrFechaInicio[2] + '/' + arrFechaInicio[1] + '/' + arrFechaInicio[0]);
                var arrFechaFin = myData[0].FechaFin.split('-');
                $("#FechaFin").val(arrFechaFin[2] + '/' + arrFechaFin[1] + '/' + arrFechaFin[0]);
            },
            error: function (xqr, errorMessage) {
            }
        });
        $.ajax({
            type: "POST",
            async: false,
            url: '/ProgramacionTurno/ObtenerDetalleProgramacionTurno/',
            cache: false,
            data: JSON.stringify(filtro),
            dataType: "JSON",
            contentType: "application/json",
            success: function (myData) {
                var grid = jQuery("#consultaEmpleados");
                for (var i = 0; i < myData.length; i++) {
                    if (myData[i].Responsable) {
                        myData[i].Responsable = "True";
                    } else {
                        myData[i].Responsable = "False";
                    }
                    grid.jqGrid('addRowData', myData[i].Codigo, myData[i]);
                }
                $("#consultaEmpleados").trigger("reloadGrid");
            },
            error: function (xqr, errorMessage) {
            }
        });


    }
    function Salir_Click() {
        window.location.href = '/#!/ProgramacionTurno';
    }
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

</script>
